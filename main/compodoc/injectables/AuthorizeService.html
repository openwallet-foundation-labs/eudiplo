<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>@eudiplo/backend documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
        <link rel="stylesheet" href="../styles/material.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">@eudiplo/backend documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">












<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >AuthorizeService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/issuer/issuance/oid4vci/authorize/authorize.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#logger" >logger</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#authzMetadata" >authzMetadata</a>
                            </li>
                            <li>
                                <a href="#getAuthorizationServer" >getAuthorizationServer</a>
                            </li>
                            <li>
                                <a href="#getAuthzIssuer" >getAuthzIssuer</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#getIssuer" >getIssuer</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#getThumbprint" >getThumbprint</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#mapToTokenErrorCode" >mapToTokenErrorCode</a>
                            </li>
                            <li>
                                <a href="#sendAuthorizationResponse" >sendAuthorizationResponse</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#setAuthCode" >setAuthCode</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#validateTokenRequest" >validateTokenRequest</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#validateWalletAttestationStatus" >validateWalletAttestationStatus</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#validateWalletProviderCertificate" >validateWalletProviderCertificate</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#verifyStatusListSignature" >verifyStatusListSignature</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#verifyWalletAttestation" >verifyWalletAttestation</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(configService: ConfigService, cryptoService: <a href="../injectables/CryptoService.html" target="_self">CryptoService</a>, cryptoImplementationService: <a href="../injectables/CryptoImplementationService.html" target="_self">CryptoImplementationService</a>, sessionService: <a href="../injectables/SessionService.html" target="_self">SessionService</a>, issuanceService: <a href="../injectables/IssuanceService.html" target="_self">IssuanceService</a>, trustStoreService: <a href="../injectables/TrustStoreService.html" target="_self">TrustStoreService</a>, x509ValidationService: <a href="../injectables/X509ValidationService.html" target="_self">X509ValidationService</a>, statusListVerifierService: <a href="../injectables/StatusListVerifierService.html" target="_self">StatusListVerifierService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="59" class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:59</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>configService</td>
                                                  
                                                        <td>
                                                                    <code>ConfigService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>cryptoService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/CryptoService.html" target="_self" >CryptoService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>cryptoImplementationService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/CryptoImplementationService.html" target="_self" >CryptoImplementationService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>sessionService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/SessionService.html" target="_self" >SessionService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>issuanceService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/IssuanceService.html" target="_self" >IssuanceService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>trustStoreService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/TrustStoreService.html" target="_self" >TrustStoreService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>x509ValidationService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/X509ValidationService.html" target="_self" >X509ValidationService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>statusListVerifierService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/StatusListVerifierService.html" target="_self" >StatusListVerifierService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="authzMetadata"></a>
                    <span class="name">
                        <span ><b>authzMetadata</b></span>
                        <a href="#authzMetadata"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>authzMetadata(tenantId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="519"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:519</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>tenantId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>AuthorizationServerMetadata</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getAuthorizationServer"></a>
                    <span class="name">
                        <span ><b>getAuthorizationServer</b></span>
                        <a href="#getAuthorizationServer"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getAuthorizationServer(tenantId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="470"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:470</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>tenantId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Oauth2AuthorizationServer</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getAuthzIssuer"></a>
                    <span class="name">
                        <span ><b>getAuthzIssuer</b></span>
                        <a href="#getAuthzIssuer"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getAuthzIssuer(tenantId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="515"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:515</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>tenantId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getIssuer"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>getIssuer</b></span>
                        <a href="#getIssuer"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getIssuer(tenantId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="78"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:78</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Get the OID4VCI issuer instance for a specific tenant.
Used for wallet attestation verification.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>tenantId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The ID of the tenant.</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Openid4vciIssuer</code>

                        </div>
                            <div class="io-description">
                                <p>The OID4VCI issuer instance.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getThumbprint"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>getThumbprint</b></span>
                        <a href="#getThumbprint"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getThumbprint(cert: x509.X509Certificate)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="370"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:370</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Calculate the SHA-256 thumbprint of an X.509 certificate.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>cert</td>
                                            <td>
                                                        <code>x509.X509Certificate</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;string&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="mapToTokenErrorCode"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>mapToTokenErrorCode</b></span>
                        <a href="#mapToTokenErrorCode"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>mapToTokenErrorCode(errorCode: string | undefined)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="486"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:486</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Map error codes from the OAuth library to OAuth 2.0 Token Error codes.
According to OID4VCI Section 6.3:</p>
<ul>
<li>invalid_request: Transaction code provided but not expected, or expected but not provided</li>
<li>invalid_grant: Wrong transaction code, wrong pre-authorized code, or expired code</li>
<li>invalid_client: Anonymous access with pre-authorized code but not supported</li>
</ul>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>errorCode</td>
                                            <td>
                                                        <code>string | undefined</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The error code from the OAuth library</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>&quot;invalid_request&quot; | &quot;invalid_client&quot; | &quot;invalid_grant&quot;</code>

                        </div>
                            <div class="io-description">
                                <p>The appropriate OAuth 2.0 token error code</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sendAuthorizationResponse"></a>
                    <span class="name">
                        <span ><b>sendAuthorizationResponse</b></span>
                        <a href="#sendAuthorizationResponse"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>sendAuthorizationResponse(values: <a href="../classes/AuthorizeQueries.html" target="_self">AuthorizeQueries</a>, tenantId: unknown)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="545"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:545</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>values</td>
                                            <td>
                                                            <code><a href="../classes/AuthorizeQueries.html" target="_self" >AuthorizeQueries</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>tenantId</td>
                                            <td>
                                                        <code>unknown</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="setAuthCode"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>setAuthCode</b></span>
                        <a href="#setAuthCode"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>setAuthCode(issuer_state: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="743"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:743</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Set the authorization code for a session based on the issuer_state and return the code.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>issuer_state</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="validateTokenRequest"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>validateTokenRequest</b></span>
                        <a href="#validateTokenRequest"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>validateTokenRequest(body: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>, req: Request, tenantId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="580"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:580</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Validate the token request.
This endpoint is used to exchange the authorization code for an access token.
Returns errors according to OID4VCI Section 6.3 Token Error Response.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>body</td>
                                            <td>
                                                            <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>req</td>
                                            <td>
                                                        <code>Request</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>tenantId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="validateWalletAttestationStatus"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>validateWalletAttestationStatus</b></span>
                        <a href="#validateWalletAttestationStatus"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>validateWalletAttestationStatus(clientAttestationJwt: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, matchedEntity: <a href="../interfaces/TrustedEntity.html" target="_self">MatchedTrustedEntity | null</a>, trustStore: <a href="../miscellaneous/typealiases.html#BuiltTrustStore" target="_self">BuiltTrustStore | null</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="160"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:160</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Validate the status of a wallet attestation JWT if it contains a status claim.
The status claim is optional per the spec, so if not present, validation passes.
Also verifies that the status list JWT is signed by the revocation certificate
from the same trusted entity that issued the wallet attestation.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>clientAttestationJwt</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The wallet attestation JWT</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>matchedEntity</td>
                                            <td>
                                                            <code><a href="../interfaces/TrustedEntity.html" target="_self" >MatchedTrustedEntity | null</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The matched trusted entity from certificate validation</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>trustStore</td>
                                            <td>
                                                            <code><a href="../miscellaneous/typealiases.html#BuiltTrustStore" target="_self" >BuiltTrustStore | null</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The trust store used for validation</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="validateWalletProviderCertificate"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>validateWalletProviderCertificate</b></span>
                        <a href="#validateWalletProviderCertificate"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>validateWalletProviderCertificate(clientAttestationJwt: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, trustListUrls: string[])</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="383"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:383</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Validate the wallet provider&#39;s X.509 certificate against configured trust lists.
Returns the matched entity and trust store for use in status list verification.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>clientAttestationJwt</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The wallet attestation JWT</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>trustListUrls</td>
                                            <td>
                                                        <code>string[]</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>URLs of trust lists to validate against</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;literal type&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>The matched entity and trust store (both null if no trust lists configured)</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="verifyStatusListSignature"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>verifyStatusListSignature</b></span>
                        <a href="#verifyStatusListSignature"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>verifyStatusListSignature(statusListJwt: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, matchedEntity: <a href="../interfaces/TrustedEntity.html" target="_self">MatchedTrustedEntity | null</a>, trustStore: <a href="../miscellaneous/typealiases.html#BuiltTrustStore" target="_self">BuiltTrustStore | null</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="239"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:239</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Verify the signature of a status list JWT against the revocation certificate
from the matched trusted entity.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>statusListJwt</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The status list JWT to verify</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>matchedEntity</td>
                                            <td>
                                                            <code><a href="../interfaces/TrustedEntity.html" target="_self" >MatchedTrustedEntity | null</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The matched trusted entity</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>trustStore</td>
                                            <td>
                                                            <code><a href="../miscellaneous/typealiases.html#BuiltTrustStore" target="_self" >BuiltTrustStore | null</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The trust store</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>true if the signature is valid and from the trusted revocation cert</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="verifyWalletAttestation"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>verifyWalletAttestation</b></span>
                        <a href="#verifyWalletAttestation"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>verifyWalletAttestation(tenantId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, clientAttestation: literal type | undefined, authorizationServer: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, walletAttestationRequired: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>, walletProviderTrustLists: string[])</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="96"
                                    class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:96</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Verify wallet attestation if provided or required.
Validates the attestation JWT signature, checks the X.509 certificate chain
against configured trust lists, and verifies the status list if present.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>tenantId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The tenant ID</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>clientAttestation</td>
                                            <td>
                                                        <code>literal type | undefined</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The client attestation from the token request</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>authorizationServer</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>The authorization server URL</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>walletAttestationRequired</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>Whether wallet attestation is required</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>walletProviderTrustLists</td>
                                            <td>
                                                        <code>string[]</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>URLs of trust lists containing trusted wallet providers</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logger"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>logger</b></span>
                        <a href="#logger"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new Logger(AuthorizeService.name)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="59" class="link-to-prism">src/issuer/issuance/oid4vci/authorize/authorize.service.ts:59</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { randomUUID, X509Certificate } from &quot;node:crypto&quot;;
import {
    ConflictException,
    Injectable,
    Logger,
    UnauthorizedException,
} from &quot;@nestjs/common&quot;;
import { ConfigService } from &quot;@nestjs/config&quot;;
import {
    type AuthorizationCodeGrantIdentifier,
    type AuthorizationServerMetadata,
    authorizationCodeGrantIdentifier,
    type HttpMethod,
    Jwk,
    Oauth2AuthorizationServer,
    PkceCodeChallengeMethod,
    PreAuthorizedCodeGrantIdentifier,
    preAuthorizedCodeGrantIdentifier,
} from &quot;@openid4vc/oauth2&quot;;
import { Openid4vciIssuer } from &quot;@openid4vc/openid4vci&quot;;
import * as x509 from &quot;@peculiar/x509&quot;;
import type { Request } from &quot;express&quot;;
import { decodeProtectedHeader, JWK } from &quot;jose&quot;;
import { v4 } from &quot;uuid&quot;;
import { CryptoService } from &quot;../../../../crypto/crypto.service&quot;;
import { CryptoImplementationService } from &quot;../../../../crypto/key/crypto-implementation/crypto-implementation.service&quot;;
import { SessionService } from &quot;../../../../session/session.service&quot;;
import { StatusListVerifierService } from &quot;../../../../shared/trust/status-list-verifier.service&quot;;
import {
    BuiltTrustStore,
    TrustStoreService,
} from &quot;../../../../shared/trust/trust-store.service&quot;;
import {
    ServiceTypeIdentifiers,
    TrustListSource,
} from &quot;../../../../shared/trust/types&quot;;
import {
    MatchedTrustedEntity,
    X509ValidationService,
} from &quot;../../../../shared/trust/x509-validation.service&quot;;
import { IssuanceService } from &quot;../../../configuration/issuance/issuance.service&quot;;
import { TokenErrorException } from &quot;../exceptions&quot;;
import { getHeadersFromRequest } from &quot;../util&quot;;
import { AuthorizeQueries } from &quot;./dto/authorize-request.dto&quot;;

export interface ParsedAccessTokenAuthorizationCodeRequestGrant {
    grantType: AuthorizationCodeGrantIdentifier;
    code: string;
}

interface ParsedAccessTokenPreAuthorizedCodeRequestGrant {
    grantType: PreAuthorizedCodeGrantIdentifier;
    preAuthorizedCode: string;
    txCode?: string;
}

@Injectable()
export class AuthorizeService {
    private readonly logger &#x3D; new Logger(AuthorizeService.name);

    constructor(
        private readonly configService: ConfigService,
        private readonly cryptoService: CryptoService,
        private readonly cryptoImplementationService: CryptoImplementationService,
        private readonly sessionService: SessionService,
        private readonly issuanceService: IssuanceService,
        private readonly trustStoreService: TrustStoreService,
        private readonly x509ValidationService: X509ValidationService,
        private readonly statusListVerifierService: StatusListVerifierService,
    ) {}

    /**
     * Get the OID4VCI issuer instance for a specific tenant.
     * Used for wallet attestation verification.
     * @param tenantId The ID of the tenant.
     * @returns The OID4VCI issuer instance.
     */
    private getIssuer(tenantId: string): Openid4vciIssuer {
        const callbacks &#x3D; this.cryptoService.getCallbackContext(tenantId);
        return new Openid4vciIssuer({
            callbacks,
        });
    }

    /**
     * Verify wallet attestation if provided or required.
     * Validates the attestation JWT signature, checks the X.509 certificate chain
     * against configured trust lists, and verifies the status list if present.
     * @param tenantId The tenant ID
     * @param clientAttestation The client attestation from the token request
     * @param authorizationServer The authorization server URL
     * @param walletAttestationRequired Whether wallet attestation is required
     * @param walletProviderTrustLists URLs of trust lists containing trusted wallet providers
     * @throws UnauthorizedException if attestation is required but not provided, or if provided but invalid
     */
    private async verifyWalletAttestation(
        tenantId: string,
        clientAttestation:
            | {
                  clientAttestationJwt: string;
                  clientAttestationPopJwt: string;
              }
            | undefined,
        authorizationServer: string,
        walletAttestationRequired: boolean,
        walletProviderTrustLists: string[],
    ): Promise&lt;void&gt; {
        if (!clientAttestation) {
            if (walletAttestationRequired) {
                throw new UnauthorizedException(
                    &quot;Wallet attestation is required but not provided&quot;,
                );
            }
            return;
        }

        try {
            // First verify the attestation JWT structure and PoP
            await this.getIssuer(tenantId).verifyWalletAttestation({
                authorizationServer,
                clientAttestationJwt: clientAttestation.clientAttestationJwt,
                clientAttestationPopJwt:
                    clientAttestation.clientAttestationPopJwt,
            });

            // Then validate the X.509 certificate against trust lists and get the matched entity
            const { matchedEntity, trustStore } &#x3D;
                await this.validateWalletProviderCertificate(
                    clientAttestation.clientAttestationJwt,
                    walletProviderTrustLists,
                );

            // Check the status list if present in the attestation JWT
            // Pass the matched entity and trust store for signature verification
            await this.validateWalletAttestationStatus(
                clientAttestation.clientAttestationJwt,
                matchedEntity,
                trustStore,
            );
        } catch (err) {
            if (err instanceof UnauthorizedException) {
                throw err;
            }
            throw new UnauthorizedException(
                &#x60;Wallet attestation verification failed: ${err instanceof Error ? err.message : &quot;Unknown error&quot;}&#x60;,
            );
        }
    }

    /**
     * Validate the status of a wallet attestation JWT if it contains a status claim.
     * The status claim is optional per the spec, so if not present, validation passes.
     * Also verifies that the status list JWT is signed by the revocation certificate
     * from the same trusted entity that issued the wallet attestation.
     * @param clientAttestationJwt The wallet attestation JWT
     * @param matchedEntity The matched trusted entity from certificate validation
     * @param trustStore The trust store used for validation
     * @throws UnauthorizedException if the attestation has been revoked or suspended
     */
    private async validateWalletAttestationStatus(
        clientAttestationJwt: string,
        matchedEntity: MatchedTrustedEntity | null,
        trustStore: BuiltTrustStore | null,
    ): Promise&lt;void&gt; {
        try {
            // Get the status entry from the JWT
            const statusEntry &#x3D;
                this.statusListVerifierService.getStatusEntryFromJwt(
                    clientAttestationJwt,
                );

            // No status claim in JWT - this is allowed per spec
            if (!statusEntry) {
                this.logger.debug(
                    &quot;Wallet attestation does not contain status claim - skipping status check&quot;,
                );
                return;
            }

            // Fetch the status list JWT
            const statusListJwt &#x3D;
                await this.statusListVerifierService.getStatusListJwt(
                    statusEntry.uri,
                );

            // Verify the status list JWT signature against the revocation cert
            const signatureValid &#x3D; await this.verifyStatusListSignature(
                statusListJwt,
                matchedEntity,
                trustStore,
            );

            if (!signatureValid) {
                throw new UnauthorizedException(
                    &quot;Status list JWT signature verification failed - not signed by trusted revocation certificate&quot;,
                );
            }

            // Now check the actual status value
            const statusResult &#x3D;
                await this.statusListVerifierService.checkStatus(
                    statusEntry.uri,
                    statusEntry.idx,
                );

            // Check if the status indicates the attestation is valid
            if (!statusResult.isValid) {
                this.logger.warn(
                    &#x60;Wallet attestation status check failed: ${statusResult.description}&#x60;,
                );
                throw new UnauthorizedException(
                    &#x60;Wallet attestation is not valid: ${statusResult.description}&#x60;,
                );
            }

            this.logger.debug(
                &#x60;Wallet attestation status verified: ${statusResult.description}&#x60;,
            );
        } catch (err) {
            if (err instanceof UnauthorizedException) {
                throw err;
            }
            // Log the error but don&#x27;t fail - status checking is optional
            // and network issues shouldn&#x27;t block valid attestations
            this.logger.warn(
                &#x60;Failed to check wallet attestation status: ${err instanceof Error ? err.message : &quot;Unknown error&quot;}&#x60;,
            );
        }
    }

    /**
     * Verify the signature of a status list JWT against the revocation certificate
     * from the matched trusted entity.
     * @param statusListJwt The status list JWT to verify
     * @param matchedEntity The matched trusted entity
     * @param trustStore The trust store
     * @returns true if the signature is valid and from the trusted revocation cert
     */
    private async verifyStatusListSignature(
        statusListJwt: string,
        matchedEntity: MatchedTrustedEntity | null,
        trustStore: BuiltTrustStore | null,
    ): Promise&lt;boolean&gt; {
        try {
            // Parse the status list JWT header
            const header &#x3D; decodeProtectedHeader(statusListJwt);
            const x5c &#x3D; header.x5c;

            // Extract public key from x5c and verify signature
            if (!x5c || x5c.length &#x3D;&#x3D;&#x3D; 0) {
                // If no x5c in status list, we can&#x27;t verify against trust chain
                // Accept if no trust validation is configured
                if (!matchedEntity) {
                    return true;
                }
                this.logger.warn(
                    &quot;Status list JWT missing x5c header - cannot verify against trust chain&quot;,
                );
                return false;
            }

            // Verify the JWT signature
            const cert &#x3D; new X509Certificate(Buffer.from(x5c[0], &quot;base64&quot;));
            const publicKey &#x3D; cert.publicKey.export({ format: &quot;jwk&quot; }) as JWK;
            const crypto &#x3D;
                this.cryptoImplementationService.getCryptoFromJwk(publicKey);
            const verifier &#x3D; await crypto.getVerifier(publicKey);

            // Split JWT and verify
            const [headerB64, payloadB64, signatureB64] &#x3D;
                statusListJwt.split(&quot;.&quot;);
            const data &#x3D; &#x60;${headerB64}.${payloadB64}&#x60;;

            const sigOk &#x3D; await verifier(data, signatureB64)
                .then(() &#x3D;&gt; true)
                .catch((e) &#x3D;&gt; {
                    this.logger.debug(
                        &#x60;Status list JWT signature invalid: ${e?.message ?? e}&#x60;,
                    );
                    return false;
                });

            if (!sigOk) return false;

            // If no entity was matched (no trust list configured), accept if signature is valid
            if (!matchedEntity || !trustStore) {
                return true;
            }

            // Check if the matched entity has a revocation certificate
            if (!matchedEntity.revocationCert) {
                this.logger.warn(
                    &#x60;TrustedEntity ${matchedEntity.entity.entityId ?? &quot;unknown&quot;} &#x60; +
                        &#x60;has no revocation certificate configured - accepting status list&#x60;,
                );
                return true;
            }

            // Build and verify the status list&#x27;s certificate chain
            const presented &#x3D; this.x509ValidationService.parseX5c(x5c);
            const leaf &#x3D; presented[0];

            // Get all certs for path building
            const allCerts &#x3D; trustStore.entities.flatMap((e) &#x3D;&gt;
                e.services.map((s) &#x3D;&gt; ({ certValue: s.certValue })),
            );
            const anchors &#x3D;
                this.x509ValidationService.parseTrustAnchors(allCerts);

            let path: x509.X509Certificate[];
            try {
                path &#x3D; await this.x509ValidationService.buildPath(
                    leaf,
                    presented,
                    anchors,
                );
            } catch (e: any) {
                this.logger.debug(
                    &#x60;Status list chain build failed: ${e?.message ?? e}&#x60;,
                );
                return false;
            }

            // Get thumbprints for comparison
            const statusLeafThumb &#x3D; await this.getThumbprint(presented[0]);
            const statusEndThumb &#x3D; await this.getThumbprint(path.at(-1)!);

            // Check if the status list is signed by the revocation cert from the same entity
            const revocationThumb &#x3D; matchedEntity.revocationThumbprint!;
            const revocationIsCa &#x3D; this.x509ValidationService.isCaCert(
                matchedEntity.revocationCert,
            );

            let statusMatchesRevocation &#x3D; false;

            if (revocationIsCa) {
                // Revocation cert is CA: path must terminate at this cert
                statusMatchesRevocation &#x3D; revocationThumb &#x3D;&#x3D;&#x3D; statusEndThumb;
            } else {
                // Revocation cert is pinned (non-CA): leaf must match
                statusMatchesRevocation &#x3D; revocationThumb &#x3D;&#x3D;&#x3D; statusLeafThumb;
            }

            if (!statusMatchesRevocation) {
                this.logger.warn(
                    &#x60;Status list is NOT signed by the revocation certificate from the same TrustedEntity. &#x60; +
                        &#x60;Entity: ${matchedEntity.entity.entityId ?? &quot;unknown&quot;}, &#x60; +
                        &#x60;Expected revocation cert: ${revocationThumb}, &#x60; +
                        &#x60;Status list leaf cert: ${statusLeafThumb}, &#x60; +
                        &#x60;Status list end cert: ${statusEndThumb}&#x60;,
                );
                return false;
            }

            this.logger.debug(
                &#x60;Status list verified against revocation cert from entity: ${matchedEntity.entity.entityId ?? &quot;unknown&quot;}&#x60;,
            );
            return true;
        } catch (e: any) {
            this.logger.error(
                &#x60;Error verifying status list signature: ${e?.message ?? e}&#x60;,
            );
            return false;
        }
    }

    /**
     * Calculate the SHA-256 thumbprint of an X.509 certificate.
     */
    private async getThumbprint(cert: x509.X509Certificate): Promise&lt;string&gt; {
        const thumbBuffer &#x3D; await cert.getThumbprint(&quot;SHA-256&quot;);
        return Buffer.from(thumbBuffer).toString(&quot;hex&quot;).toLowerCase();
    }

    /**
     * Validate the wallet provider&#x27;s X.509 certificate against configured trust lists.
     * Returns the matched entity and trust store for use in status list verification.
     * @param clientAttestationJwt The wallet attestation JWT
     * @param trustListUrls URLs of trust lists to validate against
     * @returns The matched entity and trust store (both null if no trust lists configured)
     * @throws UnauthorizedException if certificate is not trusted
     */
    private async validateWalletProviderCertificate(
        clientAttestationJwt: string,
        trustListUrls: string[],
    ): Promise&lt;{
        matchedEntity: MatchedTrustedEntity | null;
        trustStore: BuiltTrustStore | null;
    }&gt; {
        if (trustListUrls.length &#x3D;&#x3D;&#x3D; 0) {
            // No trust lists configured - accept any valid attestation
            this.logger.warn(
                &quot;No wallet provider trust lists configured - accepting attestation without certificate validation&quot;,
            );
            return { matchedEntity: null, trustStore: null };
        }

        // Extract X.509 certificate chain from JWT header
        const header &#x3D; decodeProtectedHeader(clientAttestationJwt);
        const x5c &#x3D; header.x5c;

        if (!x5c || x5c.length &#x3D;&#x3D;&#x3D; 0) {
            throw new UnauthorizedException(
                &quot;Wallet attestation JWT does not contain X.509 certificate chain (x5c header)&quot;,
            );
        }

        // Build trust list source from configured URLs
        const trustListSource: TrustListSource &#x3D; {
            lotes: trustListUrls.map((url) &#x3D;&gt; ({ url })),
            acceptedServiceTypes: [ServiceTypeIdentifiers.WalletProvider],
        };

        // Fetch and build the trust store
        const trustStore &#x3D;
            await this.trustStoreService.getTrustStore(trustListSource);

        if (trustStore.entities.length &#x3D;&#x3D;&#x3D; 0) {
            throw new UnauthorizedException(
                &quot;No trusted wallet providers found in configured trust lists&quot;,
            );
        }

        // Parse the certificate chain
        const certChain &#x3D; this.x509ValidationService.parseX5c(x5c);
        const leaf &#x3D; certChain[0];

        // Build and validate the certificate path against trust anchors
        const trustAnchors &#x3D; this.x509ValidationService.parseTrustAnchors(
            trustStore.entities.flatMap((e) &#x3D;&gt; e.services),
        );

        try {
            const path &#x3D; await this.x509ValidationService.buildPath(
                leaf,
                certChain,
                trustAnchors,
            );

            // Check if the path matches any trusted entity (using WalletProvider service type)
            const match &#x3D;
                await this.x509ValidationService.pathMatchesTrustedEntities(
                    path,
                    trustStore.entities,
                    &quot;leaf&quot;,
                    ServiceTypeIdentifiers.WalletProvider,
                );

            if (!match) {
                throw new UnauthorizedException(
                    &quot;Wallet provider certificate is not trusted - no matching entity in trust list&quot;,
                );
            }

            this.logger.debug(
                &#x60;Wallet attestation validated against trusted entity: ${match.entity.entityId ?? &quot;unknown&quot;}&#x60;,
            );

            return { matchedEntity: match, trustStore };
        } catch (err) {
            if (err instanceof UnauthorizedException) {
                throw err;
            }
            throw new UnauthorizedException(
                &#x60;Certificate chain validation failed: ${err instanceof Error ? err.message : &quot;Unknown error&quot;}&#x60;,
            );
        }
    }

    getAuthorizationServer(tenantId: string): Oauth2AuthorizationServer {
        const callbacks &#x3D; this.cryptoService.getCallbackContext(tenantId);
        return new Oauth2AuthorizationServer({
            callbacks,
        });
    }

    /**
     * Map error codes from the OAuth library to OAuth 2.0 Token Error codes.
     * According to OID4VCI Section 6.3:
     * - invalid_request: Transaction code provided but not expected, or expected but not provided
     * - invalid_grant: Wrong transaction code, wrong pre-authorized code, or expired code
     * - invalid_client: Anonymous access with pre-authorized code but not supported
     * @param errorCode The error code from the OAuth library
     * @returns The appropriate OAuth 2.0 token error code
     */
    private mapToTokenErrorCode(
        errorCode: string | undefined,
    ): &quot;invalid_request&quot; | &quot;invalid_client&quot; | &quot;invalid_grant&quot; {
        if (!errorCode) {
            return &quot;invalid_request&quot;;
        }
        // The OAuth library may return these error codes directly
        if (
            errorCode &#x3D;&#x3D;&#x3D; &quot;invalid_grant&quot; ||
            errorCode &#x3D;&#x3D;&#x3D; &quot;invalid_client&quot; ||
            errorCode &#x3D;&#x3D;&#x3D; &quot;invalid_request&quot;
        ) {
            return errorCode;
        }
        // Map specific error scenarios
        // Wrong or expired pre-authorized code &#x3D; invalid_grant
        // Wrong tx_code &#x3D; invalid_grant
        if (
            errorCode.includes(&quot;pre-authorized&quot;) ||
            errorCode.includes(&quot;pre_authorized&quot;) ||
            errorCode.includes(&quot;tx_code&quot;) ||
            errorCode.includes(&quot;transaction&quot;)
        ) {
            return &quot;invalid_grant&quot;;
        }
        // Default to invalid_request for malformed requests
        return &quot;invalid_request&quot;;
    }

    getAuthzIssuer(tenantId: string) {
        return &#x60;${this.configService.getOrThrow&lt;string&gt;(&quot;PUBLIC_URL&quot;)}/${tenantId}&#x60;;
    }

    authzMetadata(tenantId: string): AuthorizationServerMetadata {
        //TODO: read from config
        const useDpop &#x3D; true;

        const authServer &#x3D; this.getAuthzIssuer(tenantId);
        return this.getAuthorizationServer(
            tenantId,
        ).createAuthorizationServerMetadata({
            issuer: authServer,
            token_endpoint: &#x60;${authServer}/authorize/token&#x60;,
            authorization_endpoint: &#x60;${authServer}/authorize&#x60;,
            interactive_authorization_endpoint: &#x60;${authServer}/authorize/interactive&#x60;,
            jwks_uri: &#x60;${authServer}/.well-known/jwks.json&#x60;,
            dpop_signing_alg_values_supported: useDpop ? [&quot;ES256&quot;] : undefined,
            // TODO: verify this on the server
            require_pushed_authorization_requests: true,
            pushed_authorization_request_endpoint: &#x60;${authServer}/authorize/par&#x60;,
            code_challenge_methods_supported: [PkceCodeChallengeMethod.S256],
            client_attestation_pop_nonce_required: true,
            authorization_details_types_supported: [&quot;openid_credential&quot;],
            token_endpoint_auth_methods_supported: [&quot;attest_jwt_client_auth&quot;],
            client_attestation_signing_alg_values_supported: [&quot;ES256&quot;],
            client_attestation_pop_signing_alg_values_supported: [&quot;ES256&quot;],
        } as AuthorizationServerMetadata);
    }

    sendAuthorizationResponse(values: AuthorizeQueries, tenantId) {
        if (values.request_uri) {
            return this.sessionService
                .getBy({ request_uri: values.request_uri })
                .then(async (session) &#x3D;&gt; {
                    const code &#x3D; await this.setAuthCode(session.id);
                    const iss &#x3D; &#x60;${this.configService.getOrThrow&lt;string&gt;(&quot;PUBLIC_URL&quot;)}/${tenantId}&#x60;;
                    return &#x60;${session.auth_queries!.redirect_uri}?code&#x3D;${code}&amp;state&#x3D;${session.auth_queries!.state}&amp;iss&#x3D;${iss}&#x60;;
                })
                .catch(async () &#x3D;&gt; {
                    //if not found, this means the flow is initiated by the wallet and not the issuer which is also fine.
                    const code &#x3D; v4();
                    await this.sessionService.create({
                        id: v4(),
                        tenantId,
                        authorization_code: code,
                        request_uri: values.request_uri,
                    });
                    return &#x60;${values.redirect_uri}?code&#x3D;${code}&#x60;;
                });
        } else {
            throw new ConflictException(
                &quot;request_uri not found or not provided in the request&quot;,
            );
        }
    }

    /**
     * Validate the token request.
     * This endpoint is used to exchange the authorization code for an access token.
     * Returns errors according to OID4VCI Section 6.3 Token Error Response.
     * @param body
     * @param req
     * @returns
     */
    async validateTokenRequest(
        body: any,
        req: Request,
        tenantId: string,
    ): Promise&lt;any&gt; {
        const url &#x3D; &#x60;${this.configService.getOrThrow&lt;string&gt;(&quot;PUBLIC_URL&quot;)}${req.url}&#x60;;

        // Parse the access token request - malformed requests return invalid_request
        let parsedAccessTokenRequest;
        try {
            parsedAccessTokenRequest &#x3D; this.getAuthorizationServer(
                tenantId,
            ).parseAccessTokenRequest({
                accessTokenRequest: body,
                request: {
                    method: req.method as HttpMethod,
                    url,
                    headers: getHeadersFromRequest(req),
                },
            });
        } catch (err: any) {
            // Malformed token request
            throw new TokenErrorException(
                &quot;invalid_request&quot;,
                err?.message ?? &quot;The token request is malformed&quot;,
            );
        }

        const authorization_code &#x3D;
            parsedAccessTokenRequest.accessTokenRequest[
                &quot;pre-authorized_code&quot;
            ] ?? parsedAccessTokenRequest.accessTokenRequest[&quot;code&quot;];
        const session &#x3D; await this.sessionService
            .getBy({
                authorization_code,
            })
            .catch(() &#x3D;&gt; {
                throw new TokenErrorException(
                    &quot;invalid_grant&quot;,
                    &quot;The provided authorization code is invalid or expired&quot;,
                );
            });
        const issuanceConfig &#x3D;
            await this.issuanceService.getIssuanceConfiguration(tenantId);

        const authorizationServerMetadata &#x3D; await this.authzMetadata(tenantId);

        // Verify wallet attestation if required or provided
        await this.verifyWalletAttestation(
            tenantId,
            parsedAccessTokenRequest.clientAttestation,
            authorizationServerMetadata.issuer,
            issuanceConfig.walletAttestationRequired ?? false,
            issuanceConfig.walletProviderTrustLists ?? [],
        );

        let dpopValue;

        if (
            parsedAccessTokenRequest.grant.grantType &#x3D;&#x3D;&#x3D;
            preAuthorizedCodeGrantIdentifier
        ) {
            const { dpop } &#x3D; await this.getAuthorizationServer(tenantId)
                .verifyPreAuthorizedCodeAccessTokenRequest({
                    grant: parsedAccessTokenRequest.grant as ParsedAccessTokenPreAuthorizedCodeRequestGrant,
                    accessTokenRequest:
                        parsedAccessTokenRequest.accessTokenRequest,
                    request: {
                        method: req.method as HttpMethod,
                        url,
                        headers: getHeadersFromRequest(req),
                    },
                    dpop: {
                        required: issuanceConfig.dPopRequired,
                        allowedSigningAlgs:
                            authorizationServerMetadata.dpop_signing_alg_values_supported,
                        jwt: parsedAccessTokenRequest.dpop?.jwt,
                    },

                    authorizationServerMetadata,

                    expectedPreAuthorizedCode: session.authorization_code!,
                    expectedTxCode: session.credentialPayload?.tx_code,
                })
                .catch((err) &#x3D;&gt; {
                    // Map verification errors to OAuth 2.0 error codes
                    const errorCode &#x3D; this.mapToTokenErrorCode(err.error);
                    throw new TokenErrorException(
                        errorCode,
                        err.error_description,
                    );
                });
            dpopValue &#x3D; dpop;
        }

        if (
            parsedAccessTokenRequest.grant.grantType &#x3D;&#x3D;&#x3D;
            authorizationCodeGrantIdentifier
        ) {
            //TODO: handle response
            const { dpop } &#x3D; await this.getAuthorizationServer(tenantId)
                .verifyAuthorizationCodeAccessTokenRequest({
                    grant: parsedAccessTokenRequest.grant as ParsedAccessTokenAuthorizationCodeRequestGrant,
                    accessTokenRequest:
                        parsedAccessTokenRequest.accessTokenRequest,
                    expectedCode: session.authorization_code as string,
                    request: {
                        method: req.method as HttpMethod,
                        url,
                        headers: getHeadersFromRequest(req),
                    },
                    dpop: {
                        required: issuanceConfig.dPopRequired,
                        allowedSigningAlgs:
                            authorizationServerMetadata.dpop_signing_alg_values_supported,
                        jwt: parsedAccessTokenRequest.dpop?.jwt,
                    },
                    authorizationServerMetadata,
                })
                .catch((err) &#x3D;&gt; {
                    // Map verification errors to OAuth 2.0 error codes
                    const errorCode &#x3D; this.mapToTokenErrorCode(err.error);
                    throw new TokenErrorException(
                        errorCode,
                        err.error_description,
                    );
                });
            dpopValue &#x3D; dpop;
        }

        return this.getAuthorizationServer(tenantId)
            .createAccessTokenResponse({
                audience: &#x60;${this.configService.getOrThrow&lt;string&gt;(&quot;PUBLIC_URL&quot;)}/${tenantId}&#x60;,
                signer: {
                    method: &quot;jwk&quot;,
                    alg: &quot;ES256&quot;,
                    publicJwk:
                        (await this.cryptoService.keyService.getPublicKey(
                            &quot;jwk&quot;,
                            tenantId,
                        )) as Jwk,
                },
                subject: session.id,
                expiresInSeconds: 300,
                authorizationServer: authorizationServerMetadata.issuer,
                clientId: req.body.client_id,
                dpop: dpopValue,
            })
            .catch((err) &#x3D;&gt; {
                this.logger.error(&quot;Error creating access token response:&quot;, err);
                // Internal errors during token response creation
                throw new TokenErrorException(
                    &quot;invalid_request&quot;,
                    &quot;Failed to create access token response&quot;,
                );
            });
    }

    /**
     * Set the authorization code for a session based on the issuer_state and return the code.
     * @param issuer_state
     * @returns
     */
    async setAuthCode(issuer_state: string) {
        const code &#x3D; randomUUID();
        await this.sessionService.add(issuer_state, {
            authorization_code: code,
        });
        return code;
    }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'AuthorizeService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
