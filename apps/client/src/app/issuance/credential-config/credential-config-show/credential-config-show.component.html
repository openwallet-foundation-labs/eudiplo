@if (config) {
  <div fxLayout="column" fxFlex fxLayoutGap="24px">
    <!-- Header -->
    <div fxLayout="row" fxLayoutAlign="space-between center">
      <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
        <h2>Credential Configuration</h2>
      </div>
      <div>
        <button mat-icon-button [routerLink]="['../']" matTooltip="Back to list">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <button mat-icon-button [routerLink]="['edit']" matTooltip="Edit configuration">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button matTooltip="Backup configuration" (click)="downloadConfig()">
          <mat-icon>download</mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="deleteConfig()"
          matTooltip="Delete configuration"
          color="warn"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>

    <!-- Basic Information Card -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <mat-icon>settings</mat-icon>
          Configuration Details
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-list class="config-list">
          <mat-list-item>
            <mat-icon matListItemIcon>fingerprint</mat-icon>
            <span matListItemTitle>Configuration ID</span>
            <span matListItemLine>{{ config.id }}</span>
          </mat-list-item>
          @if (config.description) {
            <mat-list-item>
              <mat-icon matListItemIcon>description</mat-icon>
              <span matListItemTitle>Description</span>
              <span matListItemLine>{{ config.description }}</span>
            </mat-list-item>
          }
          <mat-list-item>
            <mat-icon matListItemIcon>timer</mat-icon>
            <span matListItemTitle>Lifetime</span>
            <span matListItemLine>{{ formatLifetime(config.lifeTime) }}</span>
          </mat-list-item>
          @if (config.cert) {
            <mat-list-item>
              <mat-icon matListItemIcon>verified_user</mat-icon>
              <span matListItemTitle>Certificate</span>
              <span matListItemLine>{{ config.cert.id }} ({{ config.cert.description }})</span>
            </mat-list-item>
          }
          @if (config.config.scope) {
            <mat-list-item>
              <mat-icon matListItemIcon>shield</mat-icon>
              <span matListItemTitle>Scope</span>
              <span matListItemLine>{{ config.config.scope }}</span>
            </mat-list-item>
          }
          <mat-list-item>
            <mat-icon matListItemIcon>
              {{ config.keyBinding ? 'lock' : 'lock_open' }}
            </mat-icon>
            <span matListItemTitle>Key Binding</span>
            <span matListItemLine>{{ config.keyBinding ? 'Enabled' : 'Disabled' }}</span>
          </mat-list-item>
          <mat-list-item>
            <mat-icon
              matListItemIcon
              [class]="config.statusManagement ? 'icon-enabled' : 'icon-disabled'"
            >
              {{ config.statusManagement ? 'verified' : 'block' }}
            </mat-icon>
            <span matListItemTitle>Status Management</span>
            <span matListItemLine>{{ config.statusManagement ? 'Enabled' : 'Disabled' }}</span>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
    </mat-card>

    <!-- VCT Information Card (SD-JWT only) -->
    @if (config.vct && !isMdocFormat) {
      <mat-card>
        <mat-card-header>
          <mat-card-title>
            <mat-icon>description</mat-icon>
            Verifiable Credential Type (VCT)
          </mat-card-title>
        </mat-card-header>
        <mat-card-content fxLayout="column" fxLayoutGap="16px">
          <div>
            <div><strong>Name:</strong></div>
            <div class="value-text">{{ config.vct.name || 'Not specified' }}</div>
          </div>

          @if (config.vct.description) {
            <div>
              <div><strong>Description:</strong></div>
              <div class="value-text">{{ config.vct.description }}</div>
            </div>
          }
          @if (config.vct.extends) {
            <div>
              <div><strong>Extends:</strong></div>
              <div class="value-text">{{ config.vct.extends }}</div>
            </div>
          }
          @if (config.vct.schema_uri) {
            <div>
              <div><strong>Schema URI:</strong></div>
              <div class="value-text">{{ config.vct.schema_uri }}</div>
            </div>
          }
        </mat-card-content>
      </mat-card>
    }

    <!-- mDOC Configuration Card (mDOC only) -->
    @if (isMdocFormat) {
      <mat-card>
        <mat-card-header>
          <mat-card-title>
            <mat-icon>badge</mat-icon>
            mDOC Configuration
          </mat-card-title>
          <mat-card-subtitle>ISO 18013-5 specific configuration</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content fxLayout="column" fxLayoutGap="16px">
          <div fxLayout="row" fxLayoutGap="32px" fxLayout.lt-md="column">
            @if (config.config.docType) {
              <div fxFlex>
                <div><strong>Document Type (docType):</strong></div>
                <div class="value-text">{{ config.config.docType }}</div>
              </div>
            }
            @if (config.config.namespace) {
              <div fxFlex>
                <div><strong>Default Namespace:</strong></div>
                <div class="value-text">{{ config.config.namespace }}</div>
              </div>
            }
          </div>
          @if (config.config.claimsByNamespace) {
            <div>
              <div><strong>Claims by Namespace:</strong></div>
              <pre class="config-value">{{ formatJsonValue(config.config.claimsByNamespace) }}</pre>
            </div>
          }
        </mat-card-content>
      </mat-card>
    }

    <!-- Credential Preview Card -->
    @if (primaryDisplay) {
      <mat-card class="preview-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>preview</mat-icon>
            Credential Preview
          </mat-card-title>
          <mat-card-subtitle>How the credential appears in wallets</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div
            class="credential-preview"
            [style.background-color]="primaryDisplay.background_color || '#FFFFFF'"
            [style.color]="primaryDisplay.text_color || '#000000'"
            [style.background-image]="
              primaryDisplay.background_image?.uri
                ? 'url(' + primaryDisplay.background_image.uri + ')'
                : 'none'
            "
          >
            @if (primaryDisplay.logo?.uri) {
              <img [src]="primaryDisplay.logo.uri" alt="Logo" class="preview-logo" />
            }
            <div class="preview-content">
              <div class="preview-name">{{ primaryDisplay.name }}</div>
              <div class="preview-description">{{ primaryDisplay.description }}</div>
              <div class="preview-locale">{{ primaryDisplay.locale }}</div>
            </div>
          </div>
          @if (config.config.display && config.config.display.length > 1) {
            <div class="locale-chips">
              <strong>Available locales:</strong>
              <mat-chip-set>
                @for (display of config.config.display; track display.locale) {
                  <mat-chip>{{ display.locale }} - {{ display.name }}</mat-chip>
                }
              </mat-chip-set>
            </div>
          }
        </mat-card-content>
      </mat-card>
    }

    <app-webhook-config-show
      [config]="config.claimsWebhook"
      title="Claims"
      descriptions="to fetch claims during issuance"
    ></app-webhook-config-show>

    <app-webhook-config-show
      [config]="config.notificationWebhook"
      title="Notifications"
      descriptions="to receive notifications during issuance"
    ></app-webhook-config-show>

    <!-- Expandable Sections -->
    <mat-accordion>
      <!-- Configuration Details -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon>tune</mat-icon>
            Configuration Details
          </mat-panel-title>
          <mat-panel-description> Technical configuration parameters </mat-panel-description>
        </mat-expansion-panel-header>

        @if (getObjectKeys(config.config).length > 0) {
          <div fxLayout="column" fxLayoutGap="12px">
            @for (key of getObjectKeys(config.config); track key) {
              <div class="config-item">
                <div class="config-key">{{ key }}:</div>
                <pre class="config-value">{{ formatJsonValue(asAny(config.config)[key]) }}</pre>
              </div>
            }
          </div>
        } @else {
          <div class="empty-state">
            <mat-icon>info</mat-icon>
            <span>No configuration parameters defined</span>
          </div>
        }
      </mat-expansion-panel>

      <!-- Default Claims -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon>fact_check</mat-icon>
            Default Claims
          </mat-panel-title>
          <mat-panel-description> Claims that will be included by default </mat-panel-description>
        </mat-expansion-panel-header>

        @if (getObjectKeys(config.claims).length > 0) {
          <div fxLayout="column" fxLayoutGap="12px">
            @for (key of getObjectKeys(config.claims); track key) {
              <div class="config-item">
                <div class="config-key">{{ key }}:</div>
                <pre class="config-value">{{ formatJsonValue(config.claims![key]) }}</pre>
              </div>
            }
          </div>
        } @else {
          <div class="empty-state">
            <mat-icon>info</mat-icon>
            <span>No default claims defined</span>
          </div>
        }
      </mat-expansion-panel>

      <!-- Disclosure Frame (SD-JWT only) -->
      @if (!isMdocFormat) {
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon>visibility</mat-icon>
              Disclosure Frame
            </mat-panel-title>
            <mat-panel-description> SD-JWT VC disclosure configuration </mat-panel-description>
          </mat-expansion-panel-header>

          @if (getObjectKeys(config.disclosureFrame).length > 0) {
            <div fxLayout="column" fxLayoutGap="12px">
              @for (key of getObjectKeys(config.disclosureFrame); track key) {
                <div class="config-item">
                  <div class="config-key">{{ key }}:</div>
                  <pre class="config-value">{{
                    formatJsonValue(config.disclosureFrame![key])
                  }}</pre>
                </div>
              }
            </div>
          } @else {
            <div class="empty-state">
              <mat-icon>info</mat-icon>
              <span>No disclosure frame defined</span>
            </div>
          }
        </mat-expansion-panel>
      }

      <!-- JSON Schema -->
      @if (config.schema) {
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon>schema</mat-icon>
              JSON Schema
            </mat-panel-title>
            <mat-panel-description> Schema validation for claims </mat-panel-description>
          </mat-expansion-panel-header>

          <div fxLayout="column" fxLayoutGap="16px">
            <div class="config-item">
              <div class="config-key">Schema:</div>
              <pre class="config-value">{{ formatJsonValue(config.schema.$schema) }}</pre>
            </div>

            <div class="config-item">
              <div class="config-key">Type:</div>
              <pre class="config-value">{{ formatJsonValue(config.schema.type) }}</pre>
            </div>

            @if (config.schema.required && config.schema.required.length > 0) {
              <div class="config-item">
                <div class="config-key">Required Fields:</div>
                <div fxLayout="row wrap" fxLayoutGap="8px" class="required-fields">
                  @for (field of config.schema.required; track field) {
                    <mat-chip>{{ field }}</mat-chip>
                  }
                </div>
              </div>
            }

            <div class="config-item">
              <div class="config-key">Properties:</div>
              <pre class="config-value">{{ formatJsonValue(config.schema.properties) }}</pre>
            </div>
          </div>
        </mat-expansion-panel>
      }

      <!-- Embedded Disclosure Policy -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon>policy</mat-icon>
            Embedded Disclosure Policy
          </mat-panel-title>
          <mat-panel-description> Policy configuration for the credential </mat-panel-description>
        </mat-expansion-panel-header>

        <div fxLayout="column" fxLayoutGap="16px">
          <div class="config-item">
            <div class="config-key">Policy:</div>
            <pre class="config-value">{{ formatJsonValue(config.embeddedDisclosurePolicy) }}</pre>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
}
