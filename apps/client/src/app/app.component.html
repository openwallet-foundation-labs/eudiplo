@if (shouldShowToolbar) {
  <mat-toolbar class="app-toolbar">
    <button matIconButton (click)="toggleSidenav()" fxHide.gt-sm>
      <mat-icon>menu</mat-icon>
    </button>
    <img src="logo.svg" alt="EUDIPLO" class="toolbar-logo" />
    <span>eudiplo</span>

    <!-- Spacer -->
    <span fxFlex></span>

    <button matIconButton [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item disabled>
        <mat-icon>account_circle</mat-icon>
        <span>Client ID: {{ apiService.getClientId() }}</span>
      </button>
      <button mat-menu-item disabled>
        <mat-icon>business</mat-icon>
        <span>Instance: {{ apiService.getBaseUrl() }}</span>
      </button>
      <a
        mat-menu-item
        href="https://openwallet-foundation-labs.github.io/eudiplo/main/"
        target="_blank"
      >
        <mat-icon>help</mat-icon>
        Documentation
      </a>

      <button mat-menu-item (click)="logout()" matTooltip="Logout">
        <mat-icon>logout</mat-icon>
        Logout
      </button>
    </mat-menu>
  </mat-toolbar>
  <mat-sidenav-container class="sidenav-container">
    <!-- Side Navigation -->
    <mat-sidenav #sidenav [mode]="sidenavMode" [opened]="sidenavOpened" class="app-sidenav">
      <mat-nav-list>
        @if (hasRole('tenants:manage')) {
          <mat-list-item [routerLink]="['/tenants']" routerLinkActive="active-link">
            <mat-icon matListItemIcon>cloud</mat-icon>
            <span matListItemTitle>Tenants</span>
          </mat-list-item>
        }

        @if (hasRole('clients:manage')) {
          <mat-list-item [routerLink]="['/clients']" routerLinkActive="active-link">
            <span matListItemTitle>Clients</span>
          </mat-list-item>
        }
        <!-- Dashboard -->
        <mat-list-item [routerLink]="['/dashboard']" routerLinkActive="active-link">
          <span matListItemTitle>Dashboard</span>
        </mat-list-item>

        <mat-divider></mat-divider>

        @if (hasRole(['presentation:offer', 'issuance:offer'])) {
          <div mat-subheader>Keys</div>
          <mat-list-item [routerLink]="['/key-management']" routerLinkActive="active-link">
            <span matListItemTitle>Key Management</span>
          </mat-list-item>

          <mat-list-item [routerLink]="['/certificates']" routerLinkActive="active-link">
            <span matListItemTitle>Certificates</span>
          </mat-list-item>
          <mat-divider></mat-divider>
        }

        <!-- Issuance Workflow -->
        @if (hasRole('issuance:manage')) {
          <div mat-subheader>Issuance</div>

          <mat-list-item [routerLink]="['/issuance-config']" routerLinkActive="active-link">
            <span matListItemTitle>Issuance Configuration</span>
          </mat-list-item>

          <mat-list-item [routerLink]="['/credential-config']" routerLinkActive="active-link">
            <span matListItemTitle>Credential Configurations</span>
          </mat-list-item>

          <mat-list-item [routerLink]="['/trust-list']" routerLinkActive="active-link">
            <span matListItemTitle>Trust Lists</span>
          </mat-list-item>

          <mat-divider></mat-divider>
        }

        @if (hasRole('presentation:manage')) {
          <!-- Verification Workflow -->
          <div mat-subheader>Credential Verification</div>

          <mat-list-item [routerLink]="['/presentation-config']" routerLinkActive="active-link">
            <span matListItemTitle>Presentation Configuration</span>
          </mat-list-item>

          <mat-divider></mat-divider>
        }

        @if (hasRole(['presentation:offer', 'issuance:offer'])) {
          <!-- Monitoring -->
          <div mat-subheader>Monitoring & Sessions</div>

          <mat-list-item
            [routerLink]="['/session-management']"
            routerLinkActive="active-link"
            [routerLinkActiveOptions]="{ exact: true }"
          >
            <span matListItemTitle>Session Management</span>
          </mat-list-item>

          @if (hasRole(['issuance:manage', 'presentation:manage'])) {
            <mat-list-item
              [routerLink]="['/session-management/config']"
              routerLinkActive="active-link"
            >
              <span matListItemTitle>Session Config</span>
            </mat-list-item>
          }
        }
      </mat-nav-list>
    </mat-sidenav>

    <!-- Main Content -->
    <mat-sidenav-content class="main-content">
      <!-- Top Toolbar -->
      <router-outlet></router-outlet>
    </mat-sidenav-content>
  </mat-sidenav-container>
} @else {
  <router-outlet></router-outlet>
}
