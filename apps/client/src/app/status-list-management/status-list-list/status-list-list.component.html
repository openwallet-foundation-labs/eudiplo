<div fxLayout="row" fxLayoutAlign="space-between center">
  <h2>Status Lists</h2>
  <div fxLayout="row" fxLayoutGap="8px">
    <button matIconButton routerLink="config" matTooltip="Configure default settings">
      <mat-icon>settings</mat-icon>
    </button>
    <button matIconButton (click)="navigateToCreate()" matTooltip="Create Status List">
      <mat-icon>add</mat-icon>
    </button>
  </div>
</div>

@if (isLoading) {
  <div class="loading-container" fxLayout="row" fxLayoutAlign="center center">
    <mat-spinner></mat-spinner>
  </div>
} @else if (dataSource.data.length === 0) {
  <div class="empty-state" fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="16px">
    <mat-icon class="empty-icon">list_alt</mat-icon>
    <p>No status lists found</p>
    <p class="hint">
      Status lists are created automatically when issuing credentials with revocation support
    </p>
    <button mat-raised-button color="primary" (click)="navigateToCreate()">
      <mat-icon>add</mat-icon>
      Create Status List
    </button>
  </div>
} @else {
  <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
    <!-- ID Column -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
      <td mat-cell *matCellDef="let list">
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="4px">
          <span>{{ list.id }}</span>
          <button matIconButton (click)="copyUri(list.uri)" matTooltip="Copy URI">
            <mat-icon>content_copy</mat-icon>
          </button>
        </div>
      </td>
    </ng-container>

    <!-- Credential Config Column -->
    <ng-container matColumnDef="credentialConfigurationId">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Bound To</th>
      <td mat-cell *matCellDef="let list">
        @if (list.credentialConfigurationId) {
          <mat-chip>{{ list.credentialConfigurationId }}</mat-chip>
        } @else {
          <span class="muted">Shared</span>
        }
      </td>
    </ng-container>

    <!-- Certificate Column -->
    <ng-container matColumnDef="certId">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Certificate</th>
      <td mat-cell *matCellDef="let list">
        @if (list.certId) {
          <mat-chip>{{ list.certId }}</mat-chip>
        } @else {
          <span class="muted">Default</span>
        }
      </td>
    </ng-container>

    <!-- Bits Column -->
    <ng-container matColumnDef="bits">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Bits</th>
      <td mat-cell *matCellDef="let list">{{ list.bits }}</td>
    </ng-container>

    <!-- Usage Column -->
    <ng-container matColumnDef="usage">
      <th mat-header-cell *matHeaderCellDef>Usage</th>
      <td mat-cell *matCellDef="let list">
        <div fxLayout="column" fxLayoutGap="4px" class="usage-cell">
          <div fxLayout="row" fxLayoutAlign="space-between center">
            <span>{{ list.usedEntries | number }} / {{ formatCapacity(list.capacity) }}</span>
            <span class="muted">{{ getUsagePercentage(list) | number: '1.0-1' }}%</span>
          </div>
          <mat-progress-bar
            [value]="getUsagePercentage(list)"
            [color]="getUsageColor(list)"
          ></mat-progress-bar>
        </div>
      </td>
    </ng-container>

    <!-- Expires At Column -->
    <ng-container matColumnDef="expiresAt">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>JWT Status</th>
      <td mat-cell *matCellDef="let list">
        @switch (getExpirationStatus(list)) {
          @case ('valid') {
            <mat-chip class="status-valid" [matTooltip]="getExpirationTooltip(list)">
              <mat-icon>check_circle</mat-icon>
              Valid
            </mat-chip>
          }
          @case ('expiring') {
            <mat-chip class="status-expiring" [matTooltip]="getExpirationTooltip(list)">
              <mat-icon>schedule</mat-icon>
              Expiring
            </mat-chip>
          }
          @case ('expired') {
            <mat-chip class="status-expired" [matTooltip]="getExpirationTooltip(list)">
              <mat-icon>refresh</mat-icon>
              Expired
            </mat-chip>
          }
          @default {
            <span class="muted" [matTooltip]="getExpirationTooltip(list)">Not generated</span>
          }
        }
      </td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let list">
        <button matIconButton (click)="navigateToEdit(list)" matTooltip="Edit">
          <mat-icon>edit</mat-icon>
        </button>
        <button
          matIconButton
          (click)="deleteList(list)"
          [disabled]="list.usedEntries > 0"
          [matTooltip]="list.usedEntries > 0 ? 'Cannot delete: entries in use' : 'Delete'"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
}
