<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="data:," />
    <title>Berlin History Museum - Resident Discount</title>
    <link rel="stylesheet" href="/shared/styles.css" />
    <link rel="stylesheet" href="styles.css" />
    <script
      src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"
      integrity="sha384-lQXOAyZwHXE55JFyrOMB7nY2Wv+m5ZWNtJcHrd1rceRQXAYNLak8ukN5TjBTcIwz"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <header>
      <a href="../" class="logo">
        <span class="logo-icon">ğŸ›ï¸</span>
        Berlin History Museum
      </a>
    </header>

    <main class="container">
      <!-- Step 1: Ticket Selection -->
      <section id="ticketSection" class="card">
        <h1>Purchase Tickets</h1>

        <div class="museum-hero">
          <div class="museum-image">
            <div class="building-art">
              <div class="pillar"></div>
              <div class="pillar"></div>
              <div class="pillar"></div>
              <div class="roof"></div>
            </div>
          </div>
          <div class="museum-info">
            <span class="museum-badge">Special Exhibition</span>
            <h2>The Wall & Beyond</h2>
            <p class="museum-subtitle">35 Years of German Reunification</p>
            <div class="museum-details">
              <span>ğŸ“… Open Daily 10:00 - 18:00</span>
              <span>ğŸ“ Unter den Linden, Berlin</span>
            </div>
          </div>
        </div>

        <div class="ticket-options">
          <h3>ğŸ« Select Your Ticket</h3>

          <div class="ticket-card" id="regularTicket">
            <div class="ticket-info">
              <span class="ticket-type">Regular Admission</span>
              <span class="ticket-desc">Full price for all visitors</span>
            </div>
            <div class="ticket-price">
              <span class="price">â‚¬16.00</span>
            </div>
          </div>

          <div class="ticket-card resident-ticket" id="residentTicket">
            <div class="resident-badge">ğŸ  Berlin Residents</div>
            <div class="ticket-info">
              <span class="ticket-type">Berlin Resident Discount</span>
              <span class="ticket-desc">50% off for Berlin citizens</span>
            </div>
            <div class="ticket-price">
              <span class="price-original">â‚¬16.00</span>
              <span class="price discounted">â‚¬8.00</span>
            </div>
            <div class="savings-tag">Save â‚¬8.00!</div>
          </div>
        </div>

        <div class="discount-info">
          <span class="info-icon">ğŸ’¡</span>
          <div>
            <strong>Berlin Resident Discount</strong>
            <p>
              As a thank you to our local community, Berlin residents enjoy 50%
              off admission. Verify your residency instantly with your EUDI
              Wallet â€“ no documents needed!
            </p>
          </div>
        </div>

        <div class="privacy-highlight">
          <span>ğŸ”’</span>
          <div>
            <strong>Privacy-First Verification</strong>
            <p>
              We only check if you live in Berlin. Your exact address, name, or
              other personal details are never shared.
            </p>
          </div>
        </div>

        <button id="verifyBtn" class="btn btn-primary btn-large">
          ğŸªª Verify Berlin Residency & Get Discount
        </button>

        <p class="skip-text">
          <a href="#" id="skipLink">Continue without discount (â‚¬16.00) â†’</a>
        </p>
      </section>

      <!-- Step 2: Residency Verification -->
      <section id="verificationSection" class="card" style="display: none">
        <h2>ğŸªª Verify Berlin Residency</h2>
        <p class="verification-subtitle">
          Scan the QR code with your EUDI Wallet to prove you live in Berlin.
        </p>

        <div class="eudi-badge">
          <span class="eu-flag">ğŸ‡ªğŸ‡º</span>
          EUDI Wallet Verified
        </div>

        <div class="data-info">
          <h3>We Will Only Check:</h3>
          <ul class="data-list">
            <li>
              <span class="data-icon">ğŸ™ï¸</span> City of Residence
              <span class="check-badge">= Berlin</span>
            </li>
          </ul>
          <div class="not-shared">
            <h4>ğŸš« We Do NOT Request:</h4>
            <ul>
              <li>Your name</li>
              <li>Your exact address</li>
              <li>Your date of birth</li>
              <li>Any other personal data</li>
            </ul>
          </div>
        </div>

        <div id="qrContainer" class="qr-container">
          <div id="qrCode" class="qr-code"></div>
          <div class="same-device-section">
            <span class="divider-text">or on this device</span>
            <div id="sameDeviceLink" class="hidden"></div>
          </div>
          <p id="statusText" class="status-text">
            Waiting for wallet connection...
          </p>
        </div>
      </section>

      <!-- Step 3: Success -->
      <section id="successSection" class="card" style="display: none">
        <div class="success-header">
          <div class="success-icon">âœ“</div>
          <h2>Berlin Residency Verified!</h2>
          <p class="success-subtitle">
            Welcome, fellow Berliner! Your discount has been applied.
          </p>
        </div>

        <div class="discount-applied">
          <div class="discount-visual">
            <div class="bear-icon">ğŸ»</div>
            <span>Berlin Resident</span>
          </div>
          <div class="price-breakdown">
            <div class="price-row">
              <span>Regular Price</span>
              <span class="strikethrough">â‚¬16.00</span>
            </div>
            <div class="price-row discount-row">
              <span>Resident Discount (50%)</span>
              <span class="discount-amount">-â‚¬8.00</span>
            </div>
            <div class="price-row total-row">
              <span>Your Price</span>
              <span class="final-price">â‚¬8.00</span>
            </div>
          </div>
        </div>

        <div class="verified-data-card">
          <h3>âœ“ Verification Result</h3>
          <div id="verifiedData" class="verified-data-list">
            <!-- Filled by JavaScript -->
          </div>
        </div>

        <div class="ticket-preview">
          <div class="ticket-stub">
            <div class="stub-header">
              <span class="stub-museum">Berlin History Museum</span>
              <span class="stub-exhibit">The Wall & Beyond</span>
            </div>
            <div class="stub-body">
              <span class="stub-type">ğŸ  RESIDENT TICKET</span>
              <span class="stub-price">â‚¬8.00</span>
            </div>
            <div class="stub-footer">
              <span class="stub-id" id="ticketId">BHM-2026-XXXXX</span>
              <span class="stub-valid">Valid for one entry</span>
            </div>
          </div>
        </div>

        <button id="purchaseBtn" class="btn btn-primary btn-large">
          ğŸ« Complete Purchase (â‚¬8.00)
        </button>

        <button id="doneBtn" class="btn btn-secondary">
          â† Back to Overview
        </button>
      </section>

      <!-- Step 4: Not Berlin -->
      <section id="notBerlinSection" class="card" style="display: none">
        <div class="info-header">
          <div class="info-icon">â„¹ï¸</div>
          <h2>Residency Not Confirmed</h2>
          <p class="info-subtitle">
            It looks like you're not currently registered as a Berlin resident.
          </p>
          <p id="notBerlinCity" class="verified-city"></p>
        </div>

        <div class="still-welcome">
          <div class="welcome-icon">ğŸ¤—</div>
          <h3>You're Still Welcome!</h3>
          <p>
            While the resident discount doesn't apply, we'd love to have you
            visit our exhibition. All visitors receive the same great
            experience!
          </p>
        </div>

        <div class="regular-ticket-offer">
          <div class="ticket-mini">
            <span class="ticket-label">Regular Admission</span>
            <span class="ticket-price-mini">â‚¬16.00</span>
          </div>
        </div>

        <button id="buyRegularBtn" class="btn btn-primary btn-large">
          ğŸ« Purchase Regular Ticket (â‚¬16.00)
        </button>

        <button id="tryAgainBtn" class="btn btn-secondary">
          â† Try Different Credential
        </button>
      </section>
    </main>

    <footer>
      <p>
        Demo application for EUDI Wallet integration â€¢
        <a
          href="https://github.com/openwallet-foundation-labs/eudiplo"
          target="_blank"
          >Powered by EUDIPLO</a
        >
      </p>
    </footer>

    <script type="module" src="/js/museum-discount/app.js"></script>
  </body>
</html>
